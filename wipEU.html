<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    .polygon {
      stroke: rgb(138, 138, 138);
    }
    .pathhidden {
      fill-opacity: 0;
      stroke-opacity: 0;
      stroke-width: 2px;
      stroke: rgb(0, 0, 25);
    }
    .pathhidden:hover {
      stroke-opacity: 1;
    }
    .tooltip {
      opacity: 0;
      background-color: "white";
      border: "solid";
      border-width: "2px";
      border-radius: "5px";
      padding: "5px";
      position: absolute;
    }
    body {
      margin: 0;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow-y: scroll;
    }
    .Titlecontainer {
      display: flex;
      justify-content: center;
    }
    .Explanationcontainer {
      margin-left: 20px;
      padding-left: 20px;
    }
    .Selectioncontainer {
      width: 250px;
      margin-left: 20px;
      float: left;
    }
    .Mapcontainer {
      margin-left: 20px;
      float: left;
    }
    .Graphcontainer {
      float: left;
    }
  </style>
</head>

<body>
  <div class="Titlecontainer">
    <h1>Titre introductif</h1>
  </div>
  <div class="Explanationcontainer">
    <p>
      Il est possible de visualiser les indicateurs pour chaque pays. Pour cela,
      il faut cliquer sur le pays d'intérêt sur la carte.
    </p>
  </div>

  <!--Déclaration des radiobutton-->

  <div class="Selectioncontainer">
    <p>Choisissez le type de déchet :</p>
    <div>
      <input type="radio" id="TOTAL" name="ProductType" value="TOTAL" checked />
      <label for="TOTAL">Total</label>
    </div>
    <div>
      <input type="radio" id="EE_LHA" name="ProductType" value="EE_LHA" />
      <label for="EE_LHA">Gros appareils ménagers</label>
    </div>
    <div>
      <input type="radio" id="EE_SHA" name="ProductType" value="EE_SHA" />
      <label for="EE_SHA">Petits appareils ménagers</label>
    </div>
    <div>
      <input type="radio" id="EE_ITT" name="ProductType" value="EE_ITT" />
      <label for="EE_ITT">
        Equipements informatiques et de télécommunications
      </label>
    </div>
    <div>
      <input
        type="radio"
        id="EE_CPV_CON"
        name="ProductType"
        value="EE_CPV_CON"
      />
      <label for="EE_CPV_CON"> Matériel grand public </label>
    </div>
    <div>
      <input type="radio" id="EE_TLS" name="ProductType" value="EE_TLS" />
      <label for="EE_TLS"> Jouets, équipements de loisirs et de sport</label>
    </div>

    <p>Choisissez l'étape du traitement:</p>
    <div>
      <input type="radio" id="MKT" name="ProductStep" value="MKT" checked />
      <label for="MKT"> Quantité mise sur le marché</label>
    </div>
    <div>
      <input type="radio" id="COL" name="ProductStep" value="COL" />
      <label for="COL"> Quantité collectée comme déchêt</label>
    </div>
    <div>
      <input type="radio" id="RCY_REU" name="ProductStep" value="RCY_REU" />
      <label for="RCY_REU">
        Quantité recyclée ou partiellement réutilisée</label
      >
    </div>
    <div>
      <input type="radio" id="RCV" name="ProductStep" value="RCV" />
      <label for="RCV"> Quantité valorisée en énergie</label>
    </div>
    <div>
      <input type="radio" id="REU" name="ProductStep" value="REU" />
      <label for="REU"> Quantité réparée et réutilisée</label>
    </div>
  </div>

  <div class="Mapcontainer"></div>
  <div class="Graphcontainer"></div>

  <!--div pour mettre l'explication de sélection-->
	<div>
		<h3>Type de produits concernés : </h3>
		<div id="expltextdiv"></div>
	<div>
  <!--div pour voir si le lien marche-->
  <div id="foo">foo</div>

  <script>
    //
    //   PARTIE SELECTION DES ATTRIBUTS
    //

    var waste = d3
      .select('input[name="ProductType"]:checked')
      .property("value");
    var year = "2018";
    var unit = "KG_HAB";
    var wst_oper = "COL";

    d3.json("./data/expl.json").then(function (expldata) {
      var expltype = expldata.type;
      d3.selectAll("input[name='ProductType']").on("change", function (event) {
        for (var i = 0; i < expltype.length; i++) {
          if (expltype[i].label == this.value) {
            d3.select("#expltextdiv").text(expltype[i].text);
          }
        }
      });
    });

    //
    //   PARTIE CARTE
    //

    var Mwidth = 600,
      Mheight = 500;
    var Msvg = d3
      .select(".Mapcontainer")
      .append("svg")
      .attr("width", Mwidth)
      .attr("height", Mheight);

    // On rajoute un groupe englobant toute la visualisation pour plus tard
    var g = Msvg.append("g");

    var projection = d3
      //.geoConicConformal()
      .geoMercator()
      .translate([Mwidth / 2, Mheight / 2])
      .scale([500])
      .center([15.454071, 50.0])
      .scale(650);

    var path = d3.geoPath().projection(projection);
    var color = d3
      .scaleQuantize()
      .range(["#edf8e9", "#bae4b3", "#74c476", "#31a354", "#006d2c"]);

    d3.json(
      "./data/european-union-countries.geojson"
    ).then(function (jsondata) {
      //polygones principaux
      g.selectAll("path")
        .data(jsondata.features)
        .enter()
        .append("path")
        .attr("fill", "#ccc")
        .attr("d", path)
        .attr("class", "polygon");

      //polygones transparents pour le réhaussement de contours
      //ajout d'un lien vers la visu par pays
      g.selectAll("pathh")
        .data(jsondata.features)
        .enter()
        .append("a")
        .attr("xlink:href", "#foo")
        .append("path")
        .attr("d", path)
        .attr("class", "pathhidden");
    });

    //
    //   PARTIE GRAPHES ANNEXES
    //

    var Gwidth = 200,
      Gheight = 500;
    var Gsvg = d3
      .select(".Graphcontainer")
      .append("svg")
      .attr("width", Gwidth)
      .attr("height", Gheight)
      .style("background-color", "green"); //juste pour voir
  </script>
</body>

